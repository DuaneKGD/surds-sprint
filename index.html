<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Surds Sprint â€” Duane Kamaragoda Tutoring</title>

  <!-- Inline SVG favicon (you can replace later) -->
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256"><rect width="100%" height="100%" fill="%232563eb"/><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="140" fill="white">âˆš</text></svg>'>

  <style>
    :root{
      --bg1:#ecf2ff;
      --bg2:#f8fafc;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --brand:#2563eb;
      --brand2:#06b6d4;
      --ok:#16a34a;
      --bad:#dc2626;
      --shadow:0 12px 32px rgba(0,0,0,.10);
      --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 60%);
    }
    .container{max-width:980px;margin:0 auto;padding:20px}
    .hero{
      background:linear-gradient(135deg,var(--brand),var(--brand2));
      color:#fff; border-radius:26px; padding:22px; box-shadow:var(--shadow)
    }
    .hero h1{margin:0 0 8px; font-size:30px; letter-spacing:.2px}
    .hero p{margin:0; opacity:.9}
    .panel{margin-top:-14px; background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .grow{flex:1}
    .stat{background:#eef2f7; padding:8px 12px; border-radius:12px; font-size:14px}
    input,button{
      font:inherit; padding:12px 14px; border-radius:12px; border:1px solid #e2e8f0; outline:none; transition:.15s
    }
    input:focus{box-shadow:0 0 0 6px rgba(37,99,235,.18); border-color:#93c5fd}
    button{border:0; background:var(--brand); color:#fff; cursor:pointer}
    button.secondary{background:#e5e7eb; color:#111}
    button.ghost{background:transparent; border:1px solid #cbd5e1; color:#111}
    button:disabled{opacity:.6; cursor:not-allowed}
    .card{background:var(--card); border-radius:var(--radius); padding:22px; box-shadow:var(--shadow); margin-top:16px}
    .question{
      font-size: clamp(28px, 5vw, 44px);
      font-weight: 800; letter-spacing:.3px; margin:6px 0 6px;
      animation: fadeIn .3s ease
    }
    .hint{color:#64748b; font-size:14px; margin-top:0}
    .feedback{min-height:28px; margin-top:10px}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .footer{color:#6b7280; font-size:12px; margin-top:18px; text-align:center}

    /* Timer bar */
    .timerWrap{background:#e2e8f0; border-radius:999px; overflow:hidden; height:14px}
    .timer{
      height:100%; width:100%;
      background:linear-gradient(90deg,#10b981,#22c55e); /* green initially */
      transition:width .25s linear, background .25s ease, box-shadow .25s ease
    }
    .timer.warn{ background:linear-gradient(90deg,#f59e0b,#f97316);} /* orange */
    .timer.danger{ background:linear-gradient(90deg,#ef4444,#dc2626); box-shadow:0 0 12px rgba(239,68,68,.45); }
    @keyframes pulse {
      0% { transform:scale(1); }
      50%{ transform:scale(1.02); }
      100%{ transform:scale(1); }
    }
    .timer.flash{ animation:pulse .6s ease 1; }

    /* Score popups */
    .floatScore{
      position:absolute; pointer-events:none; left:50%; transform:translateX(-50%);
      font-weight:800; font-size:28px; opacity:0; animation: floatUp .9s ease forwards
    }
    .floatScore.ok{ color:#22c55e; text-shadow:0 2px 6px rgba(34,197,94,.25) }
    .floatScore.bad{ color:#ef4444; text-shadow:0 2px 6px rgba(239,68,68,.25) }
    @keyframes floatUp{
      0%{ opacity:0; transform:translate(-50%, 10px) scale(.9); }
      10%{ opacity:1; transform:translate(-50%, 0) scale(1); }
      100%{ opacity:0; transform:translate(-50%, -40px) scale(1.05); }
    }

    /* Enter pop */
    .pop{ animation: pop .18s ease }
    @keyframes pop{ 0%{transform:scale(.98)} 100%{transform:scale(1)} }

    @keyframes fadeIn{ from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none} }

    /* Modal */
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(15,23,42,.35); backdrop-filter:blur(3px); z-index:20
    }
    .modal.on{ display:flex }
    .modal .sheet{ background:#fff; border-radius:18px; box-shadow:var(--shadow); max-width:520px; width:92%; padding:22px }
    .sheet h3{ margin:0 0 8px } .sheet p{ margin:0 0 12px; color:#6b7280 }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <h1>Surds Sprint</h1>
      <p>Simplify and rationalise surds as quickly as you can in <strong>60 seconds</strong>.</p>
    </header>

    <section class="panel">
      <div class="row">
        <span class="stat">Player: <strong id="playerName">â€”</strong></span>
        <span class="stat">High score: <strong id="bestScore">0</strong></span>
        <span class="stat">Time left: <strong id="timeLeft">60</strong>s</span>
        <span class="stat">Score: <strong id="score">0</strong></span>
        <span class="grow"></span>
        <button id="muteBtn" class="ghost" aria-pressed="false">ðŸ”Š Sound</button>
        <button id="changeNameBtn" class="ghost">Change name</button>
        <button id="startBtn">Start</button>
        <button id="endBtn" class="secondary">End</button>
      </div>
      <div class="timerWrap" style="margin-top:12px">
        <div id="timerBar" class="timer" style="width:100%"></div>
      </div>
    </section>

    <main class="card">
      <div class="question" id="question">Press <em>Start</em> to begin.</div>
      <div class="hint">Answer in simplest surd form. You can type <code>sqrt</code> or use <code>âˆš</code>. Skipping has no penalty.</div>
      <div class="row" style="margin-top:14px">
        <input id="answer" class="grow" placeholder="Type your answerâ€¦" autocomplete="off"/>
        <button id="submitBtn">Submit</button>
        <button id="skipBtn" class="secondary">Skip</button>
        <button id="resetBestBtn" class="ghost">Reset High Score</button>
      </div>
      <div id="feedback" class="feedback"></div>
      <div class="footer">Â© 2025 Duane Kamaragoda Tutoring â€” Progress is saved locally on this device (no accounts).</div>
    </main>
  </div>

  <!-- Name modal -->
  <div class="modal" id="nameModal" aria-modal="true" role="dialog">
    <div class="sheet">
      <h3>Welcome!</h3>
      <p>Enter your name so we can save your high score on this device.</p>
      <div class="row">
        <input id="nameInput" class="grow" placeholder="e.g., Duane"/>
        <button id="saveNameBtn">Save</button>
        <button id="cancelNameBtn" class="secondary">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    /* =======================
       CONFIG & STORAGE KEYS
    ======================= */
    const GAME_ID = 'surds-sprint-v3';
    const ROUND_SECONDS = 60;
    const KEY_NAME = `${GAME_ID}:name`;
    const KEY_BEST = `${GAME_ID}:best`;
    const START_NAME = 'Duane'; // default first-time name

    /* =======================
       DOM
    ======================= */
    const playerNameEl = document.getElementById('playerName');
    const bestScoreEl  = document.getElementById('bestScore');
    const timeLeftEl   = document.getElementById('timeLeft');
    const scoreEl      = document.getElementById('score');
    const questionEl   = document.getElementById('question');
    const answerEl     = document.getElementById('answer');
    const feedbackEl   = document.getElementById('feedback');
    const timerBar     = document.getElementById('timerBar');

    const startBtn     = document.getElementById('startBtn');
    const endBtn       = document.getElementById('endBtn');
    const submitBtn    = document.getElementById('submitBtn');
    const skipBtn      = document.getElementById('skipBtn');
    const resetBestBtn = document.getElementById('resetBestBtn');
    const changeNameBtn= document.getElementById('changeNameBtn');
    const muteBtn      = document.getElementById('muteBtn');

    const nameModal    = document.getElementById('nameModal');
    const nameInput    = document.getElementById('nameInput');
    const saveNameBtn  = document.getElementById('saveNameBtn');
    const cancelNameBtn= document.getElementById('cancelNameBtn');

    /* =======================
       STATE
    ======================= */
    let running = false;
    let score = 0;
    let best = 0;
    let timeLeft = ROUND_SECONDS;
    let timerId = null;
    let currentQ = null;
    let deck = []; // non-repeating questions for current game
    let lastDangerPulseAt = Infinity;
    let muted = false;
    let audioCtx = null;

    /* =======================
       STORAGE
    ======================= */
    const loadName = () => localStorage.getItem(KEY_NAME) || '';
    const saveName = n => localStorage.setItem(KEY_NAME, n);
    const loadBest = () => Number(localStorage.getItem(KEY_BEST) || 0);
    const saveBest = v => localStorage.setItem(KEY_BEST, String(v));

    /* =======================
       AUDIO (Web Audio API)
    ======================= */
    function ensureAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    function beep(freq=880, dur=0.12, type='sine', gain=0.04){
      if (muted) return;
      ensureAudio();
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      g.gain.value = gain;
      osc.connect(g); g.connect(audioCtx.destination);
      osc.start();
      setTimeout(()=>{ osc.stop(); }, dur*1000);
    }
    function chordOk(){
      if (muted) return;
      ensureAudio();
      // small major chord
      beep(784, .12, 'triangle', 0.05); // G5
      setTimeout(()=>beep(988,.12,'triangle',0.04), 60); // B5
      setTimeout(()=>beep(1175,.12,'triangle',0.04),110); // D6
    }
    function buzzBad(){
      if (muted) return;
      ensureAudio();
      beep(220,.15,'square',0.05);
      setTimeout(()=>beep(180,.15,'square',0.05),100);
    }

    /* =======================
       UTILS
    ======================= */
    function showModal(on=true){ nameModal.classList.toggle('on', on); if(on){ setTimeout(()=>nameInput.focus(),50);} }
    function renderHeader(){
      playerNameEl.textContent = loadName() || 'â€”';
      bestScoreEl.textContent  = best;
      timeLeftEl.textContent   = timeLeft;
      scoreEl.textContent      = score;
    }
    function setTimerBar(){
      const pct = Math.max(0, Math.min(100, 100 * (timeLeft / ROUND_SECONDS)));
      timerBar.style.width = pct + '%';
      timerBar.classList.remove('warn','danger');
      if (pct <= 35 && pct > 15) timerBar.classList.add('warn');
      if (pct <= 15) {
        timerBar.classList.add('danger');
        // flash pulse roughly every 3 seconds near the end
        if (timeLeft < lastDangerPulseAt - 3){
          timerBar.classList.add('flash');
          setTimeout(()=>timerBar.classList.remove('flash'), 600);
          lastDangerPulseAt = timeLeft;
        }
      }
    }
    function normalise(s){
      return s
        .replace(/\s+/g,'')
        .replace(/sqrt/gi,'âˆš')
        .replace(/\*/g,'')
        .toLowerCase();
    }
    function evalSurd(expr){
      try{
        let s = expr.replace(/\s+/g,'').replace(/âˆš/g,'Math.sqrt').replace(/(\d)(Math\.sqrt)/g,'$1*$2');
        if (s.includes('/')){
          const [num,den] = s.split('/');
          return (Function(`return (${num})/(${den})`))();
        }
        return (Function(`return (${s})`))();
      }catch{ return null; }
    }
    function approxEqual(aStr,bStr){
      const a = evalSurd(aStr), b = evalSurd(bStr);
      if (a==null || b==null) return false;
      return Math.abs(a-b) < 1e-6;
    }
    function animateScoreTo(target){
      const start = score;
      const diff = target - start;
      const dur = 300;
      const t0 = performance.now();
      function step(now){
        const p = Math.min(1, (now - t0)/dur);
        const eased = p<.5 ? 2*p*p : 1 - Math.pow(-2*p+2,2)/2; // easeInOutQuad
        scoreEl.textContent = Math.round(start + diff*eased);
        if (p < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }
    function floatScore(text, ok=true){
      const el = document.createElement('div');
      el.className = 'floatScore ' + (ok ? 'ok':'bad');
      el.textContent = text;
      document.body.appendChild(el);
      const cardRect = document.querySelector('.card').getBoundingClientRect();
      el.style.top = (cardRect.top + 16) + 'px';
      setTimeout(()=> el.remove(), 1000);
    }

    /* =======================
       QUESTION BANK (non-repeating per game)
       Easier focus: simple simplifications, like terms, basic rationalising.
    ======================= */
    const BANK_MASTER = [
      // Simplify âˆšn
      ['Simplify âˆš8','2âˆš2'],['Simplify âˆš12','2âˆš3'],['Simplify âˆš18','3âˆš2'],['Simplify âˆš20','2âˆš5'],
      ['Simplify âˆš24','2âˆš6'],['Simplify âˆš27','3âˆš3'],['Simplify âˆš28','2âˆš7'],['Simplify âˆš32','4âˆš2'],
      ['Simplify âˆš45','3âˆš5'],['Simplify âˆš48','4âˆš3'],['Simplify âˆš50','5âˆš2'],['Simplify âˆš72','6âˆš2'],
      ['Simplify âˆš98','7âˆš2'],['Simplify âˆš75','5âˆš3'],['Simplify âˆš63','3âˆš7'],['Simplify âˆš80','4âˆš5'],

      // Combine like terms
      ['Simplify âˆš2 + âˆš2','2âˆš2'],['Simplify 2âˆš3 + âˆš3','3âˆš3'],['Simplify 3âˆš5 - âˆš5','2âˆš5'],
      ['Simplify 4âˆš2 - 3âˆš2','âˆš2'],['Simplify 5âˆš7 + 2âˆš7','7âˆš7'],['Simplify 6âˆš3 - 4âˆš3','2âˆš3'],
      ['Simplify âˆš6 + âˆš6 + âˆš6','3âˆš6'],['Simplify 2âˆš10 - âˆš10','âˆš10'],

      // Rationalise simple denominators
      ['Rationalise 1/âˆš2','âˆš2/2'],['Rationalise 1/âˆš3','âˆš3/3'],['Rationalise 1/âˆš5','âˆš5/5'],
      ['Rationalise 2/âˆš2','âˆš2'],['Rationalise 3/âˆš3','âˆš3'],['Rationalise âˆš3/âˆš3','1'],
    ].map(([p,a])=>({p,a}));

    function makeDeck(){
      // shuffle a copy
      const arr = BANK_MASTER.slice();
      for (let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    function nextQuestion(){
      if (deck.length === 0) deck = makeDeck();
      currentQ = deck.pop();
      questionEl.textContent = currentQ.p;
      questionEl.classList.add('pop');
      setTimeout(()=>questionEl.classList.remove('pop'), 180);
      feedbackEl.textContent = '';
      answerEl.value = '';
      answerEl.focus();
    }

    /* =======================
       GAME FLOW
    ======================= */
    function start(){
      if (running) return;
      if (!loadName()) { showModal(true); return; }
      running = true;
      score = 0; renderHeader();
      timeLeft = ROUND_SECONDS; lastDangerPulseAt = Infinity;
      timerBar.classList.remove('warn','danger','flash');
      deck = makeDeck();
      nextQuestion();
      setTimerBar();
      timerId = setInterval(()=>{
        timeLeft--;
        timeLeftEl.textContent = timeLeft;
        setTimerBar();
        if (timeLeft <= 0) end();
      },1000);
    }

    function end(){
      if (!running) return;
      running = false;
      clearInterval(timerId); timerId = null;
      const msg = `Time! Final score: ${score}.`;
      feedbackEl.innerHTML = msg;
      if (score > best){
        best = score; saveBest(best);
        feedbackEl.innerHTML += ` <span class="ok"><strong>New high score!</strong></span>`;
        chordOk();
      }
      questionEl.textContent = 'Press Start to play again.';
    }

    function submit(){
      if (!running) return;
      const user = normalise(answerEl.value);
      const correct = normalise(currentQ.a);
      if (user === correct || approxEqual(user, correct)){
        const newScore = score + 20;
        floatScore('+20', true); chordOk();
        animateScoreTo(newScore); score = newScore;
        nextQuestion();
        feedbackEl.innerHTML = `<span class="ok">Nice! Keep going.</span>`;
      } else {
        const newScore = Math.max(0, score - 10);
        floatScore('-10', false); buzzBad();
        animateScoreTo(newScore); score = newScore;
        feedbackEl.innerHTML = `<span class="bad">Not quite â€” try again or skip.</span>`;
      }
    }

    function skip(){
      if (!running) return;
      nextQuestion();
      feedbackEl.textContent = '';
    }

    /* =======================
       EVENTS
    ======================= */
    startBtn.onclick = start;
    endBtn.onclick = end;
    submitBtn.onclick = submit;
    skipBtn.onclick = skip;
    resetBestBtn.onclick = ()=>{
      if (confirm('Reset high score on this device?')){
        best = 0; saveBest(0); renderHeader();
      }
    };
    changeNameBtn.onclick = ()=> showModal(true);
    muteBtn.onclick = ()=>{
      muted = !muted;
      muteBtn.textContent = muted ? 'ðŸ”‡ Sound Off' : 'ðŸ”Š Sound';
      muteBtn.setAttribute('aria-pressed', String(!muted));
    };

    answerEl.addEventListener('keydown', e=>{
      if (e.key === 'Enter') submit();
    });

    saveNameBtn.onclick = ()=>{
      const n = nameInput.value.trim();
      if (!n){ alert('Please enter a name'); return; }
      saveName(n);
      showModal(false);
      renderHeader();
      answerEl.focus();
    };
    cancelNameBtn.onclick = ()=> showModal(false);

    /* =======================
       INIT
    ======================= */
    (function init(){
      best = loadBest();
      if (!loadName()) saveName(START_NAME);
      renderHeader();
      // Prefill modal input with stored name (or default)
      nameInput.value = loadName() || START_NAME;
    })();
  </script>
</body>
</html>
