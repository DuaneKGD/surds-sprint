<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Surds Sprint</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
         margin:0; padding:24px; background:#f7fafc; color:#111}
    .card{max-width:680px; margin:0 auto; background:#fff; border-radius:16px;
          box-shadow:0 8px 24px rgba(0,0,0,.08); padding:24px}
    h1{margin:0 0 8px}
    .meta{color:#555; margin:0 0 16px}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    input,button{font-size:16px; padding:10px 12px; border-radius:10px; border:1px solid #ddd}
    button{border:0; background:#2563eb; color:#fff; cursor:pointer}
    button.secondary{background:#e5e7eb; color:#111}
    .stat{display:inline-block; background:#f1f5f9; padding:6px 10px; border-radius:8px; margin-right:8px}
    .question{font-size:22px; margin:18px 0}
    .answer{width:160px}
    .hidden{display:none}
    .ok{color:#059669}
    .bad{color:#dc2626}
  </style>
</head>
<body>
  <div class="card">
    <h1>Surds Sprint</h1>
    <p class="meta">Solve as many as you can in 60 seconds.</p>

    <div class="row" id="nameRow">
      <input id="nameInput" placeholder="Enter your name" />
      <button id="saveNameBtn">Save Name</button>
      <button class="secondary" id="clearNameBtn">Clear</button>
    </div>

    <p>
      <span class="stat">Player: <strong id="playerName">—</strong></span>
      <span class="stat">High score: <strong id="bestScore">0</strong></span>
      <span class="stat">Time: <strong id="timeLeft">60</strong>s</span>
      <span class="stat">Score: <strong id="score">0</strong></span>
    </p>

    <div id="gameArea">
      <div class="question" id="question">Press Start to begin</div>
      <div class="row">
        <input id="answer" class="answer" placeholder="Your answer" />
        <button id="submitBtn">Submit</button>
        <button id="startBtn">Start</button>
        <button class="secondary" id="resetBtn">Reset High Score</button>
      </div>
      <p id="feedback"></p>
    </div>
  </div>

  <script>
    // ------- CONFIG -------
    const GAME_ID = 'surds-sprint-v1'; // change per game/topic to keep scores separate
    const ROUND_SECONDS = 60;

    // ------- DOM -------
    const nameRow = document.getElementById('nameRow');
    const nameInput = document.getElementById('nameInput');
    const saveNameBtn = document.getElementById('saveNameBtn');
    const clearNameBtn = document.getElementById('clearNameBtn');

    const playerNameEl = document.getElementById('playerName');
    const bestScoreEl  = document.getElementById('bestScore');
    const timeLeftEl   = document.getElementById('timeLeft');
    const scoreEl      = document.getElementById('score');

    const questionEl = document.getElementById('question');
    const answerEl   = document.getElementById('answer');
    const submitBtn  = document.getElementById('submitBtn');
    const startBtn   = document.getElementById('startBtn');
    const resetBtn   = document.getElementById('resetBtn');
    const feedbackEl = document.getElementById('feedback');

    // ------- STORAGE KEYS -------
    const KEY_NAME  = `${GAME_ID}:name`;
    const KEY_BEST  = `${GAME_ID}:best`;

    // ------- STATE -------
    let running = false;
    let score = 0;
    let best = 0;
    let t = null; // timer interval id
    let timeLeft = ROUND_SECONDS;
    let currentQ = null; // { prompt, answer }

    // ------- UTIL: STORAGE -------
    function loadName(){ return localStorage.getItem(KEY_NAME) || ''; }
    function saveName(n){ localStorage.setItem(KEY_NAME, n); }
    function loadBest(){ return Number(localStorage.getItem(KEY_BEST) || 0); }
    function saveBest(v){ localStorage.setItem(KEY_BEST, String(v)); }

    // ------- QUESTION GENERATOR (Surds simplify examples) -------
    function randChoice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function genSurdQuestion(){
      // A tiny sampler; replace with your full generator later.
      // Each entry has a prompt and a canonical string answer (e.g., "5√2").
      const bank = [
        {p:"Simplify √50", a:"5√2"},
        {p:"Simplify √72", a:"6√2"},
        {p:"Simplify 2√18 + √8", a:"8√2"},
        {p:"Rationalise 1/√5", a:"√5/5"},
        {p:"Simplify √12", a:"2√3"},
        {p:"Simplify √27", a:"3√3"},
        {p:"Simplify √8 + √2", a:"3√2"},
      ];
      return randChoice(bank);
    }

    // ------- NORMALISE ANSWERS -------
    function normalise(s){
      return s
        .replace(/\s+/g,'')
        .replace(/sqrt/gi,'√')   // allow "sqrt" typing
        .replace(/\*/g,'')       // ignore asterisk
        .toLowerCase();
    }

    // ------- RENDER -------
    function setQuestion(q){
      currentQ = q;
      questionEl.textContent = q.p;
      answerEl.value = '';
      feedbackEl.textContent = '';
    }

    function renderHeader(){
      playerNameEl.textContent = loadName() || '—';
      bestScoreEl.textContent = best;
      timeLeftEl.textContent = timeLeft;
      scoreEl.textContent = score;
      nameRow.style.display = loadName() ? 'none' : 'flex';
    }

    // ------- GAME FLOW -------
    function start(){
      if (running) return;
      if (!loadName()){
        feedbackEl.textContent = 'Please enter your name to start.';
        return;
      }
      running = true;
      score = 0;
      timeLeft = ROUND_SECONDS;
      setQuestion(genSurdQuestion());
      renderHeader();
      answerEl.focus();
      t = setInterval(() => {
        timeLeft--;
        timeLeftEl.textContent = timeLeft;
        if (timeLeft <= 0){ end(); }
      }, 1000);
    }

    function end(){
      running = false;
      clearInterval(t);
      t = null;
      feedbackEl.innerHTML = `Time! Final score: <strong>${score}</strong>.`;
      if (score > best){
        best = score; saveBest(best);
        feedbackEl.innerHTML += ' <span class="ok">New high score!</span>';
      }
      renderHeader();
      questionEl.textContent = 'Press Start to play again';
    }

    function submit(){
      if (!running) return;
      const user = normalise(answerEl.value);
      const correct = normalise(currentQ.a);
      if (user === correct){
        score++;
        scoreEl.textContent = score;
        feedbackEl.innerHTML = '<span class="ok">Correct!</span>';
        setQuestion(genSurdQuestion());
      } else {
        feedbackEl.innerHTML = `<span class="bad">Try again.</span>`;
      }
      answerEl.focus();
    }

    // ------- NAME HANDLERS -------
    saveNameBtn.onclick = () => {
      const n = nameInput.value.trim();
      if (!n){ alert('Please enter a name'); return; }
      saveName(n);
      renderHeader();
    };
    clearNameBtn.onclick = () => {
      localStorage.removeItem(KEY_NAME);
      renderHeader();
      nameInput.value = '';
      nameRow.style.display = 'flex';
    };

    // ------- BUTTONS -------
    startBtn.onclick = start;
    submitBtn.onclick = submit;
    answerEl.addEventListener('keydown', e => {
      if (e.key === 'Enter') submit();
    });
    resetBtn.onclick = () => {
      if (confirm('Reset high score on this device?')){
        best = 0; saveBest(0); renderHeader();
      }
    };

    // ------- INIT -------
    best = loadBest();
    renderHeader();
    questionEl.textContent = 'Press Start to begin';
  </script>
</body>
</html>
